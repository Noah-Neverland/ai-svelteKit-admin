# 后台管理系统技术方案文档

## 1. 技术栈选型

### 1.1 核心技术栈

#### 1.1.1 前端框架：SvelteKit
**选型理由**：
- 基于 Svelte 5 编译时框架，性能优异
- 内置路由、服务端渲染（SSR）、静态站点生成（SSG）支持
- 文件系统路由，开发体验友好
- 官方支持 TypeScript
- 适合构建现代 Web 应用
- **Svelte 5 新特性**：
  - Runes 响应式系统（$state, $derived, $effect）
  - 更明确的响应式声明
  - 更好的类型推断
  - 性能优化
- **SvelteKit 最新特性**：
  - Init Hook：服务器启动时初始化
  - Transport Hook：自定义序列化
  - 服务端路由解析优化
  - WebSockets 支持（测试中）
  - 文件上传流式处理

#### 1.1.2 构建工具：Vite
**选型理由**：
- 极速的开发服务器启动
- 快速的 HMR（热模块替换）
- 优化的生产构建
- 原生 ES 模块支持
- 丰富的插件生态

#### 1.1.3 UI 组件库：shadcn-svelte
**选型理由**：
- 基于 Radix UI 和 Tailwind CSS，可访问性强
- 组件可复制到项目中，完全可控
- 支持主题定制，符合需求中的主题色切换要求
- 提供丰富的组件库
- 与 Tailwind CSS 完美集成

#### 1.1.4 样式方案：Tailwind CSS
**选型理由**：
- 实用优先的 CSS 框架
- 支持暗色模式，符合需求
- 高度可定制，支持主题色配置
- 响应式设计支持
- 与 shadcn-svelte 完美配合

#### 1.1.5 类型系统：TypeScript
**选型理由**：
- 提供类型安全
- 更好的代码提示和错误检查
- 提高代码可维护性
- 现代前端开发标准

#### 1.1.6 HTTP 客户端：Axios
**选型理由**：
- 功能完善的 HTTP 客户端
- 支持请求/响应拦截器
- 支持请求取消
- 浏览器和 Node.js 环境都支持
- 易于封装和扩展

### 1.2 辅助技术栈

#### 1.2.1 状态管理
- **Svelte 5 Runes**：使用新的 runes 系统进行状态管理
  - `$state`：声明响应式状态
  - `$derived`：声明派生状态
  - `$effect`：处理副作用
  - `$props`：组件属性（替代 export let）
- **Svelte Stores（兼容）**：对于需要跨组件共享的状态，仍可使用传统 stores
- **使用场景**：
  - 组件内部状态：使用 `$state` runes
  - 全局共享状态：使用 runes 或 stores
  - 用户信息、主题配置、语言设置、菜单状态等全局状态
- **Hooks 模式**：提供 `useForm` 和 `useTable` Hook，简化组件状态管理

#### 1.2.2 国际化方案
- **svelte-i18n** 或 **typesafe-i18n**：支持 TypeScript 的国际化方案
- **功能**：支持中文、英文切换

#### 1.2.3 表单验证
- **Zod**：TypeScript 优先的 schema 验证库
- **功能**：表单数据验证、类型安全
- **svelte-use-form** 或自定义 Hook：表单状态管理

#### 1.2.4 路由守卫
- **SvelteKit hooks**：使用 `hooks.server.ts` 和 `hooks.client.ts` 实现路由守卫
- **最新 API**：
  - `handle`：请求处理钩子（已支持 AbortSignal）
  - `init`：服务器启动时初始化（新增）
  - `transport`：自定义序列化（新增）
- **功能**：权限控制、登录状态检查

#### 1.2.5 图标库
- **lucide-svelte**：与 shadcn-svelte 配套的图标库
- **功能**：菜单图标、功能图标

#### 1.2.6 日期处理
- **date-fns**：轻量级日期处理库
- **功能**：日期格式化、计算

#### 1.2.7 工具库
- **lodash-es**：工具函数库（按需引入）
- **功能**：数据操作、工具函数

## 2. 项目架构设计

### 2.1 整体架构

```
┌─────────────────────────────────────────┐
│         用户界面层 (UI Layer)            │
│  (Svelte Components + shadcn-svelte)   │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        业务逻辑层 (Business Layer)       │
│  (Stores + Services + Utils)           │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        数据访问层 (Data Layer)           │
│      (API Client + Axios)              │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│        后端服务 (Backend API)           │
└─────────────────────────────────────────┘
```

### 2.2 分层设计

#### 2.2.1 表现层（Presentation Layer）
- **职责**：UI 渲染、用户交互
- **技术**：Svelte 组件、shadcn-svelte 组件
- **位置**：`src/lib/components/`

#### 2.2.2 业务逻辑层（Business Layer）
- **职责**：业务逻辑处理、状态管理
- **技术**：Svelte Stores、Service 层
- **位置**：`src/lib/stores/`、`src/lib/services/`

#### 2.2.3 数据访问层（Data Access Layer）
- **职责**：API 请求、数据处理
- **技术**：封装的 Axios 实例
- **位置**：`src/lib/api/`

#### 2.2.4 工具层（Utility Layer）
- **职责**：通用工具函数
- **技术**：纯函数、工具类
- **位置**：`src/lib/utils/`

## 3. 目录结构

```
ai-svelteKit-admin/
├── .env                          # 环境变量配置
├── .env.example                  # 环境变量示例
├── .gitignore                    # Git 忽略文件
├── package.json                  # 项目依赖配置
├── tsconfig.json                 # TypeScript 配置
├── vite.config.ts                # Vite 配置
├── tailwind.config.js            # Tailwind CSS 配置
├── postcss.config.js             # PostCSS 配置
├── svelte.config.js              # Svelte 配置
├── components.json               # shadcn-svelte 组件配置
│
├── src/
│   ├── app.html                  # HTML 模板
│   ├── app.d.ts                  # 全局类型定义
│   │
│   ├── routes/                   # SvelteKit 路由目录
│   │   ├── +layout.svelte        # 根布局
│   │   ├── +layout.server.ts     # 服务端布局逻辑
│   │   ├── +layout.ts            # 客户端布局逻辑
│   │   │
│   │   ├── (auth)/               # 认证相关路由组
│   │   │   ├── login/
│   │   │   │   └── +page.svelte  # 登录页面
│   │   │   ├── register/
│   │   │   │   └── +page.svelte  # 注册页面
│   │   │   ├── forgot-password/
│   │   │   │   └── +page.svelte  # 忘记密码页面
│   │   │   └── reset-password/
│   │   │       └── +page.svelte  # 重置密码页面
│   │   │
│   │   ├── (dashboard)/          # 后台管理路由组
│   │   │   ├── +layout.svelte    # 后台布局（包含菜单、顶部导航）
│   │   │   ├── +layout.server.ts # 权限检查
│   │   │   ├── +page.svelte      # 首页
│   │   │   └── [...path]/        # 动态路由
│   │   │       └── +page.svelte
│   │   │
│   │   └── +error.svelte          # 错误页面
│   │
│   ├── lib/
│   │   ├── components/           # 组件目录
│   │   │   ├── ui/               # shadcn-svelte UI 组件
│   │   │   │   ├── button/
│   │   │   │   ├── input/
│   │   │   │   ├── card/
│   │   │   │   ├── dialog/
│   │   │   │   ├── dropdown-menu/
│   │   │   │   ├── select/
│   │   │   │   ├── toast/
│   │   │   │   ├── form/
│   │   │   │   ├── table/
│   │   │   │   └── ...           # 其他 UI 组件
│   │   │   │
│   │   │   ├── layout/           # 布局组件
│   │   │   │   ├── Header.svelte        # 顶部导航栏
│   │   │   │   ├── Sidebar.svelte       # 侧边菜单栏
│   │   │   │   ├── Breadcrumb.svelte    # 面包屑导航
│   │   │   │   └── MainLayout.svelte    # 主布局容器
│   │   │   │
│   │   │   ├── auth/             # 认证相关组件
│   │   │   │   ├── LoginForm.svelte     # 登录表单
│   │   │   │   ├── RegisterForm.svelte  # 注册表单
│   │   │   │   ├── Captcha.svelte       # 验证码组件
│   │   │   │   └── ForgotPasswordForm.svelte
│   │   │   │
│   │   │   ├── menu/             # 菜单相关组件
│   │   │   │   ├── MenuItem.svelte      # 菜单项组件
│   │   │   │   ├── MenuSearch.svelte   # 菜单搜索组件
│   │   │   │   └── MenuTree.svelte     # 菜单树组件
│   │   │   │
│   │   │   └── user/             # 用户相关组件
│   │   │       ├── UserAvatar.svelte    # 用户头像
│   │   │       ├── UserDropdown.svelte  # 用户下拉菜单
│   │   │       └── ChangePasswordDialog.svelte
│   │   │   │
│   │   │   ├── form/             # 表单相关组件
│   │   │   │   ├── Form.svelte          # 表单容器组件
│   │   │   │   ├── FormField.svelte     # 表单字段组件
│   │   │   │   └── FormItem.svelte      # 表单项组件
│   │   │   │
│   │   │   └── table/            # 表格相关组件
│   │   │       ├── Table.svelte         # 表格容器组件
│   │   │       ├── TableHeader.svelte   # 表格头部组件
│   │   │       ├── TableBody.svelte     # 表格主体组件
│   │   │       ├── TableRow.svelte      # 表格行组件
│   │   │       └── TableCell.svelte     # 表格单元格组件
│   │   │
│   │   ├── stores/               # 状态管理
│   │   │   ├── auth.ts           # 认证状态
│   │   │   ├── user.ts           # 用户信息状态
│   │   │   ├── menu.ts           # 菜单状态
│   │   │   ├── theme.ts          # 主题状态（颜色、模式）
│   │   │   ├── i18n.ts           # 国际化状态
│   │   │   └── app.ts            # 应用全局状态
│   │   │
│   │   ├── api/                  # API 请求层
│   │   │   ├── client.ts         # Axios 实例封装
│   │   │   ├── interceptors.ts   # 请求/响应拦截器
│   │   │   ├── types.ts          # API 类型定义
│   │   │   │
│   │   │   ├── auth.ts           # 认证相关 API
│   │   │   ├── user.ts           # 用户相关 API
│   │   │   ├── menu.ts           # 菜单相关 API
│   │   │   └── ...               # 其他 API 模块
│   │   │
│   │   ├── services/             # 业务服务层
│   │   │   ├── auth.service.ts   # 认证服务
│   │   │   ├── user.service.ts   # 用户服务
│   │   │   ├── menu.service.ts   # 菜单服务
│   │   │   ├── permission.service.ts # 权限服务
│   │   │   └── theme.service.ts  # 主题服务
│   │   │
│   │   ├── hooks/                # Hooks 函数
│   │   │   ├── useForm.ts        # 表单 Hook
│   │   │   └── useTable.ts       # 表格 Hook
│   │   │
│   │   ├── utils/                # 工具函数
│   │   │   ├── request.ts        # HTTP 请求工具（基于 axios）
│   │   │   ├── storage.ts        # 本地存储工具
│   │   │   ├── validation.ts     # 数据验证工具
│   │   │   ├── format.ts         # 数据格式化工具
│   │   │   ├── date.ts           # 日期处理工具
│   │   │   ├── permission.ts     # 权限判断工具
│   │   │   ├── router.ts         # 路由工具
│   │   │   └── file.ts           # 文件处理工具
│   │   │
│   │   ├── config/               # 配置文件
│   │   │   ├── app.config.ts     # 应用配置
│   │   │   ├── api.config.ts     # API 配置
│   │   │   ├── menu.config.ts    # 菜单配置（前端配置）
│   │   │   └── theme.config.ts   # 主题配置
│   │   │
│   │   ├── types/                # TypeScript 类型定义
│   │   │   ├── auth.types.ts     # 认证相关类型
│   │   │   ├── user.types.ts     # 用户相关类型
│   │   │   ├── menu.types.ts     # 菜单相关类型
│   │   │   ├── form.types.ts     # 表单相关类型
│   │   │   ├── table.types.ts    # 表格相关类型
│   │   │   ├── api.types.ts     # API 响应类型
│   │   │   └── common.types.ts   # 通用类型
│   │   │
│   │   └── constants/            # 常量定义
│   │       ├── routes.ts         # 路由常量
│   │       ├── roles.ts          # 角色常量
│   │       ├── permissions.ts    # 权限常量
│   │       └── i18n.ts           # 国际化常量
│   │
│   ├── hooks/                    # SvelteKit hooks
│   │   ├── hooks.server.ts       # 服务端 hooks（权限检查）
│   │   └── hooks.client.ts       # 客户端 hooks
│   │
│   └── styles/                   # 全局样式
│       ├── app.css               # 全局样式文件
│       └── theme.css             # 主题样式文件
│
├── static/                       # 静态资源
│   ├── favicon.ico
│   ├── logo.png
│   └── images/
│
├── docs/                         # 文档目录
│   ├── 需求分析文档.md
│   └── 技术方案.md
│
└── tests/                        # 测试文件（可选）
    ├── unit/
    └── e2e/
```

## 4. 核心功能技术实现方案

### 4.1 用户认证模块

#### 4.1.1 登录功能
**技术方案**：
- **页面路由**：`src/routes/(auth)/login/+page.svelte`
- **组件**：`LoginForm.svelte` 使用 shadcn-svelte 的表单组件
- **状态管理**：
  - 组件内部状态使用 `$state` runes（Svelte 5）
  - 全局认证状态使用 `auth` store（基于 runes）
- **API 调用**：通过 `auth.service.ts` 调用登录接口
- **验证码**：独立的 `Captcha.svelte` 组件，支持刷新
- **记住我**：使用 `storage.ts` 工具保存 token 到 localStorage
- **路由守卫**：在 `hooks.server.ts` 中检查登录状态（使用最新 API）

#### 4.1.2 注册功能
**技术方案**：
- **页面路由**：`src/routes/(auth)/register/+page.svelte`
- **表单验证**：使用 Zod 进行表单数据验证
- **状态管理**：使用 `$state` runes 管理表单状态
- **API 调用**：通过 `auth.service.ts` 调用注册接口
- **验证码**：复用 `Captcha.svelte` 组件

#### 4.1.3 忘记密码功能
**技术方案**：
- **页面路由**：`src/routes/(auth)/forgot-password/+page.svelte`
- **重置链接页面**：`src/routes/(auth)/reset-password/+page.svelte`
- **流程控制**：使用 Svelte 组件状态管理流程步骤
- **邮箱验证**：通过 API 发送重置链接

### 4.2 角色权限管理

#### 4.2.1 权限控制方案
**技术方案**：
- **路由守卫**：在 `hooks.server.ts` 中实现服务端权限检查
- **权限 Store**：`permission.service.ts` 管理用户权限
- **权限指令**：创建自定义 Svelte 指令用于组件级权限控制
- **菜单过滤**：`menu.service.ts` 根据角色过滤菜单项

#### 4.2.2 权限判断工具
**技术方案**：
- **工具函数**：`src/lib/utils/permission.ts`
- **功能**：提供 `hasPermission()`、`hasRole()` 等函数
- **使用场景**：组件中条件渲染、路由守卫

### 4.3 国际化功能

#### 4.3.1 国际化方案
**技术方案**：
- **库选择**：使用 `typesafe-i18n` 或 `svelte-i18n`
- **语言文件**：`src/lib/constants/i18n/zh.ts`、`src/lib/constants/i18n/en.ts`
- **语言 Store**：`i18n.ts` store 管理当前语言
- **持久化**：语言选择保存到 localStorage
- **切换组件**：在 Header 组件中提供语言切换下拉菜单

#### 4.3.2 国际化内容
**技术方案**：
- **菜单名称**：菜单配置中包含多语言键值
- **页面内容**：使用 `$t()` 函数进行翻译
- **错误信息**：API 错误信息支持国际化

### 4.4 主题和模式切换

#### 4.4.1 主题色切换
**技术方案**：
- **主题配置**：使用 Tailwind CSS 的 CSS 变量
- **主题 Store**：`theme.ts` 使用 `$state` runes 管理当前主题色
- **主题文件**：`src/lib/config/theme.config.ts` 定义 shadcn-svelte 主题色
- **动态切换**：通过 `$effect` 监听主题变化，修改 `:root` CSS 变量
- **持久化**：主题选择保存到 localStorage

#### 4.4.2 黑白模式切换
**技术方案**：
- **Tailwind 暗色模式**：使用 `dark:` 前缀
- **模式 Store**：`theme.ts` 使用 `$state` runes 管理当前模式
- **动态切换**：通过 `$effect` 监听模式变化，修改 `<html>` 的 `class` 或 `data-theme` 属性
- **跟随系统**：使用 `prefers-color-scheme` 媒体查询（可选）

### 4.5 动态菜单栏

#### 4.5.1 菜单配置方案
**技术方案**：
- **前端配置**：`src/lib/config/menu.config.ts` 定义菜单结构
- **服务端配置**：通过 `menu.service.ts` 调用 API 获取菜单
- **配置开关**：在 `app.config.ts` 中配置菜单来源
- **菜单 Store**：`menu.ts` store 管理菜单数据和状态
- **缓存机制**：使用 localStorage 缓存服务端菜单配置

#### 4.5.2 菜单组件
**技术方案**：
- **菜单树组件**：`MenuTree.svelte` 递归渲染多级菜单
- **菜单项组件**：`MenuItem.svelte` 单个菜单项
- **菜单搜索**：`MenuSearch.svelte` 实现搜索功能
- **图标支持**：使用 `lucide-svelte` 图标库

#### 4.5.3 菜单交互
**技术方案**：
- **折叠/展开**：使用 Svelte 状态管理菜单展开状态
- **激活状态**：根据当前路由高亮对应菜单项
- **路由跳转**：使用 SvelteKit 的 `goto()` 函数

### 4.6 顶部导航栏

#### 4.6.1 Header 组件
**技术方案**：
- **组件位置**：`src/lib/components/layout/Header.svelte`
- **布局结构**：使用 Flexbox 布局，左侧 Logo，右侧操作区
- **Logo 组件**：可点击，跳转到首页
- **操作区**：语言切换、主题切换、模式切换、用户信息

#### 4.6.2 用户信息展示
**技术方案**：
- **用户头像**：`UserAvatar.svelte` 组件
- **下拉菜单**：使用 shadcn-svelte 的 `DropdownMenu` 组件
- **用户信息**：从 `user.ts` store 获取

### 4.7 用户操作功能

#### 4.7.1 退出登录
**技术方案**：
- **确认对话框**：使用 shadcn-svelte 的 `Dialog` 组件
- **清除状态**：清除 `auth` store 和 `user` store
- **清除存储**：清除 localStorage 和 sessionStorage
- **路由跳转**：跳转到登录页面

#### 4.7.2 修改密码
**技术方案**：
- **对话框组件**：`ChangePasswordDialog.svelte`
- **表单验证**：使用 Zod 验证密码强度
- **API 调用**：通过 `user.service.ts` 调用修改密码接口

### 4.8 HTTP 请求封装

#### 4.8.1 Axios 封装方案
**技术方案**：
- **实例创建**：`src/lib/api/client.ts` 创建 Axios 实例
- **请求拦截器**：
  - 添加 Authorization header（从 store 获取 token）
  - 添加语言标识 header
  - 添加请求时间戳
- **响应拦截器**：
  - 统一处理响应数据格式
  - 处理 401 未授权（跳转登录）
  - 处理 403 无权限（显示提示）
  - 统一错误处理
- **请求方法封装**：提供 `get`、`post`、`put`、`delete`、`patch` 方法
- **类型安全**：使用 TypeScript 泛型确保类型安全

#### 4.8.2 错误处理方案
**技术方案**：
- **错误类型定义**：`src/lib/types/api.types.ts`
- **错误处理函数**：统一错误处理逻辑
- **错误提示**：使用 shadcn-svelte 的 `Toast` 组件显示错误
- **国际化支持**：错误信息支持多语言

#### 4.8.3 请求重试机制
**技术方案**：
- **重试配置**：在请求配置中设置重试次数和重试延迟
- **重试条件**：网络错误或特定状态码（如 500、502、503）
- **实现方式**：在响应拦截器中实现重试逻辑

### 4.9 面包屑导航

#### 4.9.1 面包屑实现方案
**技术方案**：
- **组件**：`Breadcrumb.svelte` 使用 shadcn-svelte 的 Breadcrumb 组件
- **数据来源**：根据当前路由和菜单配置生成面包屑路径
- **工具函数**：`src/lib/utils/router.ts` 提供生成面包屑的函数
- **路由监听**：监听路由变化，自动更新面包屑

#### 4.9.2 面包屑交互
**技术方案**：
- **点击跳转**：使用 `goto()` 函数跳转到对应路由
- **当前页标识**：当前页不可点击，使用不同样式

### 4.10 表单组件封装

#### 4.10.1 Form 组件封装方案
**技术方案**：
- **基础组件**：基于 shadcn-svelte 的 Form 组件进行封装
- **组件位置**：`src/lib/components/form/Form.svelte`
- **Hook 封装**：`src/lib/hooks/useForm.ts` 提供 `useForm` Hook
- **类型定义**：`src/lib/types/form.types.ts` 定义表单相关类型

#### 4.10.2 useForm Hook 设计
**技术方案**：
- **功能**：
  - 表单状态管理（值、错误、验证状态）
  - 表单验证（基于 Zod schema）
  - 表单提交处理
  - 表单重置
  - 字段级验证
- **返回值**：
  - `form`：表单状态和方法
  - `register`：字段注册函数
  - `handleSubmit`：提交处理函数
  - `errors`：错误信息对象
  - `isValid`：表单验证状态
- **使用方式**：在 Svelte 组件中通过 `useForm()` 调用

#### 4.10.3 Form 组件配置方案
**技术方案**：
- **字段配置**：通过 `columns` 数组配置表单字段
- **字段类型**：支持 `component` 字段指定渲染组件
- **自定义渲染**：支持 `render` 方法自定义字段内容
- **字段属性**：
  - `name`：字段名称
  - `label`：字段标签
  - `component`：渲染组件（如：Input、Select、DatePicker 等）
  - `rules`：验证规则（Zod schema）
  - `render`：自定义渲染函数
  - `props`：传递给组件的属性

#### 4.10.4 Form 组件使用示例
**技术方案**：
- **配置驱动**：通过配置数组生成表单，减少模板代码
- **组件注册**：自动注册 shadcn-svelte 组件（Input、Select、Checkbox 等）
- **类型安全**：使用 TypeScript 泛型确保类型安全
- **灵活扩展**：支持自定义组件和渲染函数

### 4.11 表格组件封装

#### 4.11.1 Table 组件封装方案
**技术方案**：
- **基础组件**：基于 shadcn-svelte 的 Table 组件进行封装
- **组件位置**：`src/lib/components/table/Table.svelte`
- **Hook 封装**：`src/lib/hooks/useTable.ts` 提供 `useTable` Hook
- **类型定义**：`src/lib/types/table.types.ts` 定义表格相关类型

#### 4.11.2 useTable Hook 设计
**技术方案**：
- **功能**：
  - 表格数据管理
  - 分页状态管理
  - 排序状态管理
  - 筛选状态管理
  - 选择状态管理（多选/单选）
  - 数据加载状态
- **返回值**：
  - `data`：表格数据
  - `columns`：列配置
  - `pagination`：分页信息和方法
  - `sorting`：排序信息和方法
  - `filtering`：筛选信息和方法
  - `selection`：选择信息和方法
  - `loading`：加载状态
  - `refresh`：刷新数据方法

#### 4.11.3 Table Columns 配置方案
**技术方案**：
- **列配置结构**：通过 `columns` 数组配置表格列
- **列属性**：
  - `key`：列唯一标识
  - `title`：列标题
  - `dataIndex`：数据字段名
  - `component`：渲染组件（如：Tag、Badge、Avatar 等）
  - `render`：自定义渲染函数
  - `width`：列宽度
  - `align`：对齐方式
  - `sortable`：是否可排序
  - `filterable`：是否可筛选
  - `fixed`：固定列（left/right）
- **组件渲染**：通过 `component` 字段指定 shadcn-svelte 组件进行渲染
- **自定义渲染**：通过 `render` 方法自定义单元格内容
- **类型安全**：使用 TypeScript 泛型确保列配置类型安全

#### 4.11.4 Table 组件功能
**技术方案**：
- **基础功能**：
  - 数据展示
  - 列排序
  - 列筛选
  - 分页
  - 行选择
- **高级功能**：
  - 列固定（左右固定）
  - 列拖拽排序
  - 列宽调整
  - 虚拟滚动（大数据量）
  - 导出功能（可选）

#### 4.11.5 Table 组件使用示例
**技术方案**：
- **配置驱动**：通过 columns 配置生成表格，减少模板代码
- **组件注册**：自动识别 shadcn-svelte 组件（Tag、Badge、Button 等）
- **灵活扩展**：支持自定义组件和 render 函数
- **类型安全**：使用 TypeScript 泛型确保数据类型安全

### 4.12 通用工具函数

#### 4.12.1 本地存储工具
**技术方案**：
- **文件位置**：`src/lib/utils/storage.ts`
- **功能**：封装 localStorage 和 sessionStorage
- **类型安全**：使用 TypeScript 泛型
- **功能**：提供 `get`、`set`、`remove`、`clear` 方法

#### 4.12.2 数据验证工具
**技术方案**：
- **文件位置**：`src/lib/utils/validation.ts`
- **使用 Zod**：基于 Zod 提供验证函数
- **功能**：邮箱验证、密码强度验证、手机号验证等

#### 4.12.3 日期处理工具
**技术方案**：
- **文件位置**：`src/lib/utils/date.ts`
- **使用 date-fns**：基于 date-fns 提供日期格式化函数
- **功能**：日期格式化、日期计算、相对时间显示

## 5. 状态管理方案

### 5.1 Svelte 5 Runes 状态管理

#### 5.1.1 Runes 基础
**Svelte 5 引入了新的 runes 系统，提供更明确的响应式声明**：

- **`$state`**：声明响应式状态
  ```typescript
  let count = $state(0);
  let user = $state<UserInfo | null>(null);
  ```

- **`$derived`**：声明派生状态（替代 `$:`）
  ```typescript
  let double = $derived(count * 2);
  let isAuthenticated = $derived(!!user);
  ```

- **`$effect`**：处理副作用（替代 `$:` 副作用块）
  ```typescript
  $effect(() => {
    if (user) {
      console.log('User logged in:', user);
    }
  });
  ```

- **`$props`**：组件属性（替代 `export let`）
  ```typescript
  let { name, age = 18 } = $props<{ name: string; age?: number }>();
  ```

#### 5.1.2 全局状态管理策略
**对于需要跨组件共享的状态，有两种方案**：

1. **使用 Runes + 模块级状态**（推荐）
   - 在模块中声明 `$state`，导出访问函数
   - 适合简单的全局状态

2. **使用传统 Stores**（兼容）
   - 对于复杂状态或需要 store 特性的场景
   - 与 runes 完全兼容

### 5.2 Store 设计

#### 5.2.1 认证 Store（auth.ts）
**技术方案**：
- **使用 Svelte 5 Runes**：使用 `$state` 管理状态
- **功能**：
  - 管理登录状态
  - 存储 token
  - 提供登录、登出方法
- **实现方式**：
  ```typescript
  class AuthState {
    isAuthenticated = $state(false);
    token = $state<string | null>(null);
    user = $state<UserInfo | null>(null);
    
    login(token: string, user: UserInfo) { ... }
    logout() { ... }
  }
  export const auth = new AuthState();
  ```

#### 5.2.2 用户 Store（user.ts）
**技术方案**：
- **使用 Svelte 5 Runes**：使用 `$state` 管理用户信息
- **功能**：
  - 存储用户信息
  - 提供更新用户信息方法

#### 5.2.3 菜单 Store（menu.ts）
**技术方案**：
- **使用 Svelte 5 Runes**：使用 `$state` 和 `$derived` 管理菜单
- **功能**：
  - 存储菜单数据
  - 管理菜单展开/折叠状态
  - 提供菜单搜索功能
  - 使用 `$derived` 计算过滤后的菜单

#### 5.2.4 主题 Store（theme.ts）
**技术方案**：
- **使用 Svelte 5 Runes**：使用 `$state` 和 `$effect` 管理主题
- **功能**：
  - 管理主题色
  - 管理黑白模式
  - 持久化主题设置
  - 使用 `$effect` 同步 DOM 类名

#### 5.2.5 国际化 Store（i18n.ts）
**技术方案**：
- **使用 Svelte 5 Runes**：使用 `$state` 和 `$derived` 管理国际化
- **功能**：
  - 管理当前语言
  - 提供语言切换方法
  - 持久化语言设置
  - 使用 `$derived` 计算翻译函数

## 6. 路由设计

### 6.1 路由结构

#### 6.1.1 认证路由组 `(auth)`
- `/login` - 登录页面
- `/register` - 注册页面
- `/forgot-password` - 忘记密码页面
- `/reset-password` - 重置密码页面

#### 6.1.2 后台管理路由组 `(dashboard)`
- `/` - 首页
- `[...path]` - 动态路由，支持多级路径

### 6.2 路由守卫

#### 6.2.1 服务端守卫
**实现位置**：`src/hooks/hooks.server.ts`
**最新 API**：
- **`handle`**：请求处理钩子
  - 支持 `AbortSignal`（通过 `event.request.signal`）
  - 支持异步处理
- **`init`**：服务器启动时初始化（可选）
  - 用于初始化数据库连接等异步任务
- **`transport`**：自定义序列化（可选）
  - 用于序列化/反序列化非 POJO 对象
**功能**：
- 检查登录状态
- 检查页面权限
- 重定向未授权用户
- 添加请求头（如语言标识）

#### 6.2.2 客户端守卫
**实现位置**：`src/hooks/hooks.client.ts`
**功能**：
- 客户端路由拦截
- 权限检查
- 使用 `$effect` 监听路由变化

## 7. 样式方案

### 7.1 Tailwind CSS 配置

#### 7.1.1 主题色配置
**技术方案**：
- 在 `tailwind.config.js` 中配置 shadcn-svelte 主题色
- 使用 CSS 变量实现动态主题切换
- 支持 8 种主题色：Default、Red、Rose、Orange、Green、Blue、Yellow、Violet
- 参考 [shadcn-svelte 主题配置](https://www.shadcn-svelte.com/themes)

#### 7.1.2 暗色模式配置
**技术方案**：
- 启用 Tailwind 的 `darkMode: 'class'`
- 通过 JavaScript 切换 `<html>` 的 `class`
- 使用 `dark:` 前缀定义暗色模式样式

### 7.2 响应式设计
**技术方案**：
- 使用 Tailwind 的响应式断点
- 移动端适配：菜单栏可折叠
- 平板适配：调整布局结构

## 8. 开发规范

### 8.1 代码规范

#### 8.1.1 TypeScript 规范
- 所有文件使用 TypeScript
- 提供完整的类型定义
- 避免使用 `any` 类型
- 使用接口定义数据结构

#### 8.1.2 组件规范
- 组件使用 PascalCase 命名
- 组件文件与组件名一致
- 组件 props 使用 TypeScript 接口定义
- 组件内部状态使用 Svelte 响应式语法

#### 8.1.3 文件命名规范
- 组件文件：PascalCase（如：`UserAvatar.svelte`）
- 工具函数：camelCase（如：`formatDate.ts`）
- Store 文件：camelCase（如：`auth.ts`）
- 配置文件：kebab-case（如：`app.config.ts`）

### 8.2 目录规范
- 按功能模块组织代码
- 公共组件放在 `components/ui/`
- 业务组件放在对应功能目录
- 工具函数按功能分类

### 8.3 提交规范
- 使用语义化提交信息
- 提交前运行代码检查
- 提交前运行类型检查

## 9. 性能优化方案

### 9.1 代码分割
**技术方案**：
- SvelteKit 自动代码分割
- 路由级别的代码分割
- 动态导入大型组件

### 9.2 资源优化
**技术方案**：
- 图片懒加载
- 图标按需引入
- CSS 按需加载

### 9.3 缓存策略
**技术方案**：
- 菜单配置缓存到 localStorage
- API 响应缓存（可选）
- 静态资源缓存

## 10. 安全方案

### 10.1 前端安全
**技术方案**：
- Token 存储在 httpOnly cookie（推荐）或 localStorage
- XSS 防护：使用 Svelte 的内置转义
- CSRF 防护：使用 token 验证
- 敏感信息不存储在客户端

### 10.2 权限控制
**技术方案**：
- 服务端权限验证（主要）
- 前端权限控制（辅助）
- 路由守卫防止未授权访问

## 11. 测试方案（可选）

### 11.1 单元测试
**技术方案**：
- 使用 Vitest 进行单元测试
- 测试工具函数
- 测试 Store 逻辑

### 11.2 组件测试
**技术方案**：
- 使用 @testing-library/svelte
- 测试组件渲染
- 测试用户交互

### 11.3 E2E 测试
**技术方案**：
- 使用 Playwright
- 测试关键用户流程
- 测试跨浏览器兼容性

## 12. 部署方案

### 12.1 构建配置
**技术方案**：
- 使用 Vite 进行生产构建
- 优化构建输出
- 生成 source map（可选）
- 支持 CSR（客户端渲染）和 SSR（服务端渲染）两种构建模式

### 12.2 部署模式

#### 12.2.1 CSR 模式（客户端渲染）
**技术方案**：
- **构建方式**：使用 SvelteKit 的静态适配器（`@sveltejs/adapter-static`）
- **特点**：
  - 所有页面在客户端渲染
  - 构建为纯静态文件（HTML、CSS、JS）
  - 首次加载后，后续路由切换在客户端完成
  - SEO 友好性相对较弱
- **适用场景**：
  - 纯前端应用
  - 不需要服务端渲染的场景
  - 部署到静态托管服务（如：GitHub Pages、Netlify、Vercel）
- **配置方式**：
  - 在 `svelte.config.js` 中配置 `adapter-static`
  - 设置 `prerender: true` 预渲染所有页面
- **部署步骤**：
  1. 运行构建命令生成静态文件
  2. 将构建输出目录部署到静态服务器
  3. 配置服务器路由规则（SPA 回退到 index.html）

#### 12.2.2 SSR 模式（服务端渲染）
**技术方案**：
- **构建方式**：使用 SvelteKit 的 Node.js 适配器（`@sveltejs/adapter-node`）或其他 SSR 适配器
- **特点**：
  - 页面在服务端渲染后返回给客户端
  - 首屏加载速度快
  - SEO 友好
  - 支持服务端数据获取
- **适用场景**：
  - 需要 SEO 优化的应用
  - 需要服务端数据预取
  - 需要服务端权限检查
  - 部署到 Node.js 服务器或支持 SSR 的平台
- **配置方式**：
  - 在 `svelte.config.js` 中配置对应的适配器
  - 配置服务端渲染选项
- **部署步骤**：
  1. 运行构建命令生成服务端和客户端代码
  2. 启动 Node.js 服务器
  3. 配置反向代理（如：Nginx）
  4. 配置进程管理（如：PM2）

#### 12.2.3 混合模式（SSR + CSR）
**技术方案**：
- **构建方式**：使用 SvelteKit 的通用适配器（如：`@sveltejs/adapter-auto`）
- **特点**：
  - 部分页面 SSR，部分页面 CSR
  - 根据路由配置选择渲染方式
  - 灵活控制渲染策略
- **配置方式**：
  - 在页面组件中设置 `export const ssr = true/false`
  - 在 `+page.ts` 或 `+layout.ts` 中控制预渲染
- **适用场景**：
  - 需要 SEO 的页面使用 SSR
  - 纯交互页面使用 CSR
  - 动态内容页面使用 SSR

### 12.3 适配器选择

#### 12.3.1 静态适配器（CSR）
**技术方案**：
- **适配器**：`@sveltejs/adapter-static`
- **部署平台**：
  - GitHub Pages
  - Netlify（静态模式）
  - Vercel（静态模式）
  - 任何静态文件服务器
- **配置示例**：
  - 在 `svelte.config.js` 中引入并配置适配器
  - 设置预渲染选项

#### 12.3.2 Node.js 适配器（SSR）
**技术方案**：
- **适配器**：`@sveltejs/adapter-node`
- **部署平台**：
  - 自建 Node.js 服务器
  - Docker 容器
  - 云服务器（如：AWS EC2、阿里云 ECS）
- **配置示例**：
  - 在 `svelte.config.js` 中引入并配置适配器
  - 配置构建输出目录
  - 配置环境变量

#### 12.3.3 平台适配器（自动）
**技术方案**：
- **适配器**：`@sveltejs/adapter-auto`
- **特点**：自动检测部署平台并选择合适适配器
- **支持平台**：
  - Vercel（自动 SSR）
  - Netlify（自动 SSR）
  - Cloudflare Pages
  - 其他支持的平台

### 12.4 构建命令配置

#### 12.4.1 CSR 构建命令
**技术方案**：
- **开发环境**：`pnpm dev`
- **构建命令**：`pnpm build`
- **预览命令**：`pnpm preview`
- **输出目录**：`build/` 目录包含所有静态文件

#### 12.4.2 SSR 构建命令
**技术方案**：
- **开发环境**：`pnpm dev`
- **构建命令**：`pnpm build`
- **启动命令**：`pnpm start`
- **输出目录**：
  - `.svelte-kit/` 包含构建后的应用代码
  - `build/` 包含服务端和客户端代码

### 12.5 环境变量配置

#### 12.5.1 环境变量文件
**技术方案**：
- **开发环境**：`.env.development`
- **生产环境**：`.env.production`
- **通用配置**：`.env`
- **示例文件**：`.env.example`

#### 12.5.2 环境变量使用
**技术方案**：
- **CSR 模式**：使用 `PUBLIC_` 前缀的变量可在客户端访问
- **SSR 模式**：服务端和客户端环境变量分别配置
- **安全考虑**：敏感信息（如 API Key）不在客户端暴露

### 12.6 部署优化建议

#### 12.6.1 CSR 模式优化
**技术方案**：
- 启用代码分割和懒加载
- 压缩静态资源
- 配置 CDN 加速
- 启用浏览器缓存
- 使用 Service Worker（可选）

#### 12.6.2 SSR 模式优化
**技术方案**：
- 启用服务端缓存
- 配置反向代理缓存
- 优化数据库查询
- 使用 CDN 加速静态资源
- 配置负载均衡（高并发场景）

## 13. 开发工具配置

### 13.1 开发环境
- **Node.js**：推荐使用 LTS 版本
- **包管理器**：pnpm
- **编辑器**：VS Code + Svelte 插件

### 13.2 代码质量工具
- **ESLint**：代码检查
- **Prettier**：代码格式化
- **TypeScript**：类型检查

### 13.3 开发辅助工具
- **Vite DevTools**：开发调试工具
- **Svelte DevTools**：Svelte 组件调试

---

## 14. Svelte 5 迁移指南

### 14.1 从 Svelte 4 迁移到 Svelte 5

#### 14.1.1 自动迁移工具
**使用官方迁移工具**：
```bash
npx sv migrate svelte-5
```
该工具会自动转换大部分代码。

#### 14.1.2 手动迁移要点

1. **响应式变量**：
   - `let count = 0;` → `let count = $state(0);`

2. **派生值**：
   - `$: double = count * 2;` → `let double = $derived(count * 2);`

3. **副作用**：
   - `$: { ... }` → `$effect(() => { ... });`

4. **组件属性**：
   - `export let name;` → `let { name } = $props();`

5. **Store 订阅**：
   - `$store` 语法仍然可用，但推荐使用 runes

#### 14.1.3 兼容性说明
- Svelte 4 的 stores 在 Svelte 5 中完全兼容
- 可以逐步迁移，不需要一次性全部更改
- 新旧语法可以混用

### 14.2 SvelteKit 最新特性使用

#### 14.2.1 Init Hook
**用途**：服务器启动时初始化
```typescript
// hooks.server.ts
export const init = async () => {
  // 初始化数据库连接等
  await initializeDatabase();
};
```

#### 14.2.2 Transport Hook
**用途**：自定义序列化
```typescript
// hooks.server.ts
export const transport = {
  encode: (value) => { /* 序列化 */ },
  decode: (value) => { /* 反序列化 */ }
};
```

#### 14.2.3 AbortSignal 支持
**用途**：请求取消
```typescript
// hooks.server.ts
export const handle = async ({ event, resolve }) => {
  const signal = event.request.signal;
  // 使用 signal 进行请求管理
};
```

---

**文档版本**：v2.0  
**创建日期**：2025-01-27  
**最后更新**：2025-01-27  
**更新内容**：
- 添加 Svelte 5 Runes 状态管理方案
- 更新 SvelteKit 最新 API 说明
- 添加迁移指南

